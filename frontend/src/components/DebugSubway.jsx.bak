// frontend/src/components/DebugSubway.jsx - ë””ë²„ê¹…ìš© ì»´í¬ë„ŒíŠ¸
import React, { useEffect } from 'react';
import { useSubwayContext } from '../contexts/SubwayContext';

const DebugSubway = () => {
  const {
    lines,
    stations,
    arrivalData,
    selectedLine,
    selectedStation,
    loading,
    errors,
    isInitialized,
    setSelectedLine,
    setSelectedStation
  } = useSubwayContext();

  // ìƒíƒœ ë³€í™” ë¡œê¹…
  useEffect(() => {
    console.log('[Debug Component] State changed:', {
      isInitialized,
      lines: lines.length,
      stations: stations.length,
      arrivalData: Object.keys(arrivalData).length,
      selectedLine,
      selectedStation,
      loading,
      errors
    });
  }, [isInitialized, lines, stations, arrivalData, selectedLine, selectedStation, loading, errors]);

  // ìˆ˜ë™ API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
  const testAPI = async () => {
    try {
      console.log('[Debug] API ì§ì ‘ í…ŒìŠ¤íŠ¸ ì‹œì‘');
      
      // 1. ë…¸ì„  í…ŒìŠ¤íŠ¸
      const response1 = await fetch('http://localhost:5000/api/subway/lines');
      const lines = await response1.json();
      console.log('[Debug] ë…¸ì„  API ì‘ë‹µ:', lines);
      
      // 2. ì—­ ëª©ë¡ í…ŒìŠ¤íŠ¸
      const response2 = await fetch('http://localhost:5000/api/subway/stations/2í˜¸ì„ ');
      const stations = await response2.json();
      console.log('[Debug] ì—­ ëª©ë¡ API ì‘ë‹µ:', stations);
      
      // 3. ë„ì°© ì •ë³´ í…ŒìŠ¤íŠ¸
      const response3 = await fetch('http://localhost:5000/api/subway/arrival/ì‹œì²­');
      const arrival = await response3.json();
      console.log('[Debug] ë„ì°© ì •ë³´ API ì‘ë‹µ:', arrival);
      
    } catch (error) {
      console.error('[Debug] API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
    }
  };

  return (
    <div className="p-4 bg-gray-100 m-4 rounded">
      <h2 className="text-lg font-bold mb-4">ğŸ› ì§€í•˜ì²  API ë””ë²„ê·¸</h2>
      
      {/* ìƒíƒœ ì •ë³´ */}
      <div className="mb-4">
        <h3 className="font-semibold">ğŸ“Š í˜„ì¬ ìƒíƒœ</h3>
        <ul className="text-sm">
          <li>ì´ˆê¸°í™”ë¨: {isInitialized ? 'âœ…' : 'âŒ'}</li>
          <li>ë…¸ì„  ê°œìˆ˜: {lines.length}</li>
          <li>ì—­ ê°œìˆ˜: {stations.length}</li>
          <li>ë„ì°©ì •ë³´ í‚¤: {Object.keys(arrivalData).length}</li>
          <li>ì„ íƒëœ í˜¸ì„ : {selectedLine || 'ì—†ìŒ'}</li>
          <li>ì„ íƒëœ ì—­: {selectedStation || 'ì—†ìŒ'}</li>
        </ul>
      </div>

      {/* ë¡œë”© ìƒíƒœ */}
      <div className="mb-4">
        <h3 className="font-semibold">â³ ë¡œë”© ìƒíƒœ</h3>
        <pre className="text-xs bg-white p-2 rounded">
          {JSON.stringify(loading, null, 2)}
        </pre>
      </div>

      {/* ì—ëŸ¬ ìƒíƒœ */}
      {Object.values(errors).some(Boolean) && (
        <div className="mb-4">
          <h3 className="font-semibold text-red-600">âŒ ì—ëŸ¬</h3>
          <pre className="text-xs bg-red-50 p-2 rounded">
            {JSON.stringify(errors, null, 2)}
          </pre>
        </div>
      )}

      {/* í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ */}
      <div className="space-y-2">
        <button 
          onClick={testAPI}
          className="bg-blue-500 text-white px-4 py-2 rounded"
        >
          ğŸ” API ì§ì ‘ í…ŒìŠ¤íŠ¸
        </button>
        
        <button 
          onClick={() => setSelectedLine('2í˜¸ì„ ')}
          className="bg-green-500 text-white px-4 py-2 rounded ml-2"
        >
          ğŸš‡ 2í˜¸ì„  ì„ íƒ
        </button>
        
        <button 
          onClick={() => setSelectedStation('ì‹œì²­')}
          className="bg-purple-500 text-white px-4 py-2 rounded ml-2"
          disabled={!selectedLine}
        >
          ğŸ›ï¸ ì‹œì²­ì—­ ì„ íƒ
        </button>
      </div>

      {/* ë…¸ì„  ëª©ë¡ */}
      {lines.length > 0 && (
        <div className="mt-4">
          <h3 className="font-semibold">ğŸš‡ ë…¸ì„  ëª©ë¡</h3>
          <div className="text-xs">
            {lines.map(line => (
              <span key={line.id} className="inline-block bg-blue-100 px-2 py-1 rounded mr-2 mb-1">
                {line.name}
              </span>
            ))}
          </div>
        </div>
      )}

      {/* ì—­ ëª©ë¡ */}
      {stations.length > 0 && (
        <div className="mt-4">
          <h3 className="font-semibold">ğŸ›ï¸ {selectedLine} ì—­ ëª©ë¡</h3>
          <div className="text-xs">
            {stations.map(station => (
              <span key={station} className="inline-block bg-green-100 px-2 py-1 rounded mr-2 mb-1">
                {station}
              </span>
            ))}
          </div>
        </div>
      )}

      {/* ë„ì°© ì •ë³´ */}
      {Object.keys(arrivalData).length > 0 && (
        <div className="mt-4">
          <h3 className="font-semibold">ğŸšŠ ë„ì°© ì •ë³´</h3>
          <pre className="text-xs bg-yellow-50 p-2 rounded overflow-auto max-h-40">
            {JSON.stringify(arrivalData, null, 2)}
          </pre>
        </div>
      )}
    </div>
  );
};

export default DebugSubway;